<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Notifica√ß√µes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #0f172a;
            color: white;
        }
        .test-button {
            padding: 12px 20px;
            background: #22d3ee;
            color: #0f172a;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px;
        }
        .test-button:hover {
            background: #06b6d4;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #22d3ee; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>üß™ Teste do Sistema de Notifica√ß√µes</h1>
    
    <div>
        <button class="test-button" onclick="testarConfigJS()">1. Testar config.js</button>
        <button class="test-button" onclick="testarBrlFunction()">2. Testar fun√ß√£o brl()</button>
        <button class="test-button" onclick="testarEndpoint()">3. Testar /api/notificacoes</button>
        <button class="test-button" onclick="testarRenderizacao()">4. Testar renderiza√ß√£o</button>
        <button class="test-button" onclick="limparOutput()">Limpar</button>
    </div>
    
    <div id="output"></div>
    
    <script src="/static/config.js"></script>
    <script>
        function log(msg, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : (type === 'success' ? 'success' : '');
            output.innerHTML += `<div class="${className}">[${timestamp}] ${msg}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function limparOutput() {
            document.getElementById('output').innerHTML = '';
        }
        
        function testarConfigJS() {
            log('Testando carregamento do config.js...');
            
            if (typeof API_BASE !== 'undefined') {
                log(`‚úì API_BASE definido: ${API_BASE}`, 'success');
            } else {
                log('‚úó API_BASE n√£o definido', 'error');
            }
            
            if (typeof window.CONFIG !== 'undefined') {
                log('‚úì window.CONFIG definido', 'success');
                log(`  - API_BASE: ${window.CONFIG.API_BASE}`, 'success');
            } else {
                log('‚úó window.CONFIG n√£o definido', 'error');
            }
        }
        
        function testarBrlFunction() {
            log('Testando fun√ß√£o brl()...');
            
            if (typeof brl === 'undefined') {
                log('‚úó Fun√ß√£o brl() n√£o definida', 'error');
                return;
            }
            
            if (typeof brl !== 'function') {
                log(`‚úó brl n√£o √© uma fun√ß√£o, √© ${typeof brl}`, 'error');
                return;
            }
            
            try {
                const resultado = brl(1234.56);
                log(`‚úì brl(1234.56) = ${resultado}`, 'success');
            } catch (error) {
                log(`‚úó Erro ao chamar brl(): ${error.message}`, 'error');
            }
        }
        
        async function testarEndpoint() {
            log('Testando endpoint /api/notificacoes...');
            
            try {
                const response = await fetch(`${API_BASE}/api/notificacoes`);
                
                if (!response.ok) {
                    log(`‚úó Resposta com erro: ${response.status} ${response.statusText}`, 'error');
                    return;
                }
                
                const data = await response.json();
                log(`‚úì Endpoint respondeu com sucesso`, 'success');
                log(`  - Total de notifica√ß√µes: ${data.total}`, 'success');
                log(`  - N√£o lidas: ${data.nao_lidas}`, 'success');
                log(`  - Stats: ${JSON.stringify(data.stats)}`, 'success');
                
                if (data.notificacoes && data.notificacoes.length > 0) {
                    log(`  - Primeira notifica√ß√£o:`, 'success');
                    const n = data.notificacoes[0];
                    log(`    Tipo: ${n.tipo}, T√≠tulo: ${n.titulo}, Valor: ${n.valor}`, 'success');
                }
                
                return data;
            } catch (error) {
                log(`‚úó Erro ao buscar notifica√ß√µes: ${error.message}`, 'error');
            }
        }
        
        async function testarRenderizacao() {
            log('Testando renderiza√ß√£o de notifica√ß√µes...');
            
            const data = await testarEndpoint();
            
            if (!data) {
                log('‚úó N√£o foi poss√≠vel obter dados para renderizar', 'error');
                return;
            }
            
            if (!data.notificacoes || data.notificacoes.length === 0) {
                log('‚úì Nenhuma notifica√ß√£o para renderizar', 'success');
                return;
            }
            
            log('Tentando renderizar cada notifica√ß√£o...');
            
            data.notificacoes.forEach((n, index) => {
                try {
                    const valorFormatado = brl(n.valor);
                    log(`‚úì Notifica√ß√£o ${index + 1}: ${n.titulo} - ${valorFormatado}`, 'success');
                } catch (error) {
                    log(`‚úó Erro ao renderizar notifica√ß√£o ${index + 1}: ${error.message}`, 'error');
                }
            });
        }
        
        // Executar testes automaticamente ao carregar
        window.addEventListener('load', () => {
            log('=== Testes Autom√°ticos ===');
            testarConfigJS();
            testarBrlFunction();
        });
    </script>
</body>
</html>
